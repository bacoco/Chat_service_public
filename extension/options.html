<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Universal Web Assistant Settings</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      background: #f5f5f5;
    }
    
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      margin: 0 0 30px 0;
      color: #333;
      font-size: 24px;
    }
    
    .section {
      margin-bottom: 30px;
    }
    
    .section h2 {
      font-size: 18px;
      color: #555;
      margin: 0 0 15px 0;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #666;
      font-size: 14px;
      font-weight: 500;
    }
    
    input[type="text"],
    input[type="password"],
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
      background: white;
    }
    
    input[type="text"]:focus,
    input[type="password"]:focus,
    select:focus {
      outline: none;
      border-color: #4285f4;
    }
    
    .help-text {
      margin-top: 6px;
      font-size: 12px;
      color: #888;
    }
    
    .help-text a {
      color: #4285f4;
      text-decoration: none;
    }
    
    .help-text a:hover {
      text-decoration: underline;
    }
    
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #3367d6;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .button-secondary {
      background: #f1f3f4;
      color: #5f6368;
      border: 1px solid #dadce0;
    }
    
    .button-secondary:hover {
      background: #e8eaed;
    }
    
    .button-danger {
      background: #dc3545;
      color: white;
    }
    
    .button-danger:hover {
      background: #c82333;
    }
    
    .success-message,
    .error-message {
      padding: 12px;
      border-radius: 4px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }
    
    .success-message {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .error-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .api-key-status {
      display: inline-block;
      margin-left: 10px;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 3px;
    }
    
    .api-key-status.configured {
      background: #d4edda;
      color: #155724;
    }
    
    .api-key-status.not-configured {
      background: #f8d7da;
      color: #721c24;
    }
    
    .instructions {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 4px;
      margin-bottom: 30px;
    }
    
    .instructions h3 {
      margin: 0 0 12px 0;
      font-size: 16px;
      color: #333;
    }
    
    .instructions ol {
      margin: 0;
      padding-left: 20px;
    }
    
    .instructions li {
      margin-bottom: 8px;
      color: #666;
      font-size: 14px;
    }
    
    .tabs {
      display: flex;
      border-bottom: 2px solid #e0e0e0;
      margin-bottom: 30px;
    }
    
    .tab {
      padding: 12px 24px;
      cursor: pointer;
      border: none;
      background: none;
      font-size: 14px;
      font-weight: 500;
      color: #666;
      transition: all 0.3s;
      position: relative;
    }
    
    .tab:hover {
      color: #4285f4;
    }
    
    .tab.active {
      color: #4285f4;
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: #4285f4;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block !important;
    }
    
    .slider-container {
      margin-top: 10px;
    }
    
    .slider {
      width: 100%;
      height: 5px;
      border-radius: 5px;
      background: #ddd;
      outline: none;
      -webkit-appearance: none;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #4285f4;
      cursor: pointer;
    }
    
    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #4285f4;
      cursor: pointer;
      border: none;
    }
    
    .slider-value {
      display: inline-block;
      margin-left: 10px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
      <h1 style="margin: 0;">Universal Web Assistant Settings</h1>
      <button id="closeButton" class="button-secondary" style="padding: 8px 20px;">Close</button>
    </div>
    
    <div class="success-message" id="successMessage"></div>
    <div class="error-message" id="errorMessage"></div>
    
    <div class="tabs">
      <button class="tab active" data-tab="model">Model Configuration</button>
      <button class="tab" data-tab="storage">Data Storage</button>
      <button class="tab" data-tab="appearance">Appearance</button>
      <button class="tab" data-tab="shortcuts">Shortcuts</button>
      <button class="tab" data-tab="about">About</button>
    </div>
    
    <!-- Model Configuration Tab -->
    <div class="tab-content active" id="modelTab">
      <div class="instructions">
        <h3>Quick Setup Guide:</h3>
        <ol>
          <li>Select your AI provider (Albert is free and default)</li>
          <li>For Albert: Visit <a href="https://albert.api.etalab.gouv.fr" target="_blank">albert.api.etalab.gouv.fr</a> to get a free API key</li>
          <li>Enter your API key and test the connection</li>
          <li>Save your settings</li>
        </ol>
      </div>
      
      <div class="section">
        <h2>AI Model Configuration</h2>
        
        <div class="form-group">
          <label for="provider">AI Provider</label>
          <select id="provider">
            <option value="albert" selected>Albert (French Government AI - Free)</option>
            <option value="openai">OpenAI (ChatGPT)</option>
            <option value="anthropic">Anthropic (Claude)</option>
            <option value="custom">Custom API Endpoint</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="apiEndpoint">API Endpoint</label>
          <input type="text" id="apiEndpoint" placeholder="https://api.example.com/v1" value="https://albert.api.etalab.gouv.fr/v1">
          <div class="help-text">
            The base URL for API requests. This is automatically set based on your provider.
          </div>
        </div>
        
        <div class="form-group">
          <label for="model">Model</label>
          <select id="model">
            <option value="albert-large">albert-large (Most capable)</option>
            <option value="albert-base">albert-base (Balanced)</option>
            <option value="albert-light">albert-light (Fastest)</option>
          </select>
          <div class="help-text" id="modelHelp">
            Choose the model based on your needs. Larger models are more capable but slower.
          </div>
        </div>
        
        <div class="form-group">
          <label for="apiKey">
            API Key
            <span class="api-key-status" id="apiKeyStatus"></span>
          </label>
          <input type="password" id="apiKey" placeholder="Enter your API key">
          <div class="help-text">
            Your API key is stored securely in your browser and only sent to your selected AI provider.
          </div>
        </div>
        
        <div class="button-group">
          <button id="testButton" class="button-secondary">Test Connection</button>
          <button id="saveButton">Save Settings</button>
          <button id="clearButton" class="button-danger">Clear Credentials</button>
        </div>
      </div>
    </div>
    
    <!-- Data Storage Tab -->
    <div class="tab-content" id="storageTab">
      <div class="instructions">
        <h3>Supabase Integration Setup:</h3>
        <ol>
          <li>Create a free Supabase account at <a href="https://supabase.com" target="_blank">supabase.com</a></li>
          <li>Create a new project and copy your project URL and anon key</li>
          <li>Enable Row Level Security (RLS) policies for your tables</li>
          <li>Configure your settings below to start persisting chat history and Jina transcriptions</li>
        </ol>
      </div>
      
      <div class="section">
        <h2>Supabase Configuration</h2>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="enableSupabase">
            Enable Supabase data persistence
          </label>
          <div class="help-text">
            When enabled, all chat history and Jina transcriptions will be saved to your Supabase database
          </div>
        </div>
        
        <div class="form-group">
          <label for="supabaseUrl">Supabase Project URL</label>
          <input type="text" id="supabaseUrl" placeholder="https://your-project.supabase.co">
          <div class="help-text">
            Your Supabase project URL from the API settings in your Supabase dashboard
          </div>
        </div>
        
        <div class="form-group">
          <label for="supabaseKey">Supabase Anon Key</label>
          <input type="password" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
          <div class="help-text">
            Your Supabase anon/public key from the API settings in your Supabase dashboard
          </div>
        </div>
        
        <div class="form-group">
          <label for="userId">User Identifier</label>
          <input type="text" id="userId" placeholder="user123 or email@example.com">
          <div class="help-text">
            A unique identifier for your data. This helps separate your data from other users.
          </div>
        </div>
        
        <div class="form-group">
          <label for="dataRetention">Data Retention (days)</label>
          <select id="dataRetention">
            <option value="7">7 days</option>
            <option value="30" selected>30 days</option>
            <option value="90">90 days</option>
            <option value="365">1 year</option>
            <option value="0">Never delete</option>
          </select>
          <div class="help-text">
            How long to keep chat history and Jina transcriptions before automatic cleanup
          </div>
        </div>
        
        <div class="button-group">
          <button id="testSupabaseButton" class="button-secondary">Test Connection</button>
          <button id="saveStorageButton">Save Settings</button>
          <button id="clearStorageButton" class="button-danger">Clear All Data</button>
        </div>
        
        <div class="form-group" style="margin-top: 20px;">
          <label>Database Setup</label>
          <div class="help-text">
            <strong>Required SQL to run in your Supabase SQL editor:</strong>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; font-family: monospace; white-space: pre-wrap; font-size: 12px;">-- Create chat_sessions table
CREATE TABLE chat_sessions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  url TEXT NOT NULL,
  site_type VARCHAR(50),
  language VARCHAR(10),
  domain VARCHAR(255),
  title TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Create chat_messages table
CREATE TABLE chat_messages (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  session_id UUID REFERENCES chat_sessions(id) ON DELETE CASCADE,
  role VARCHAR(20) NOT NULL,
  message TEXT NOT NULL,
  context JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create jina_transcriptions table
CREATE TABLE jina_transcriptions (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  url TEXT NOT NULL,
  content TEXT NOT NULL,
  user_id VARCHAR(255) NOT NULL,
  cached_until TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create indexes for better performance
CREATE INDEX idx_chat_sessions_user_id ON chat_sessions(user_id);
CREATE INDEX idx_chat_messages_session_id ON chat_messages(session_id);
CREATE INDEX idx_jina_transcriptions_user_id ON jina_transcriptions(user_id);
CREATE INDEX idx_jina_transcriptions_url ON jina_transcriptions(url);

-- Enable RLS (Row Level Security)
ALTER TABLE chat_sessions ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_messages ENABLE ROW LEVEL SECURITY;
ALTER TABLE jina_transcriptions ENABLE ROW LEVEL SECURITY;

-- Create policies (adjust based on your authentication needs)
CREATE POLICY "Users can manage their own sessions" ON chat_sessions FOR ALL USING (true);
CREATE POLICY "Users can manage their own messages" ON chat_messages FOR ALL USING (true);
CREATE POLICY "Users can manage their own transcriptions" ON jina_transcriptions FOR ALL USING (true);</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Appearance Tab -->
    <div class="tab-content" id="appearanceTab">
      <div class="section">
        <h2>Widget Appearance</h2>
        
        <div class="form-group">
          <label for="position">Widget Position</label>
          <select id="position">
            <option value="bottom-right">Bottom Right</option>
            <option value="bottom-left">Bottom Left</option>
            <option value="top-right">Top Right</option>
            <option value="top-left">Top Left</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="theme">Theme</label>
          <select id="theme">
            <option value="auto">Auto (Follow System)</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="fontSize">Text Size</label>
          <select id="fontSize">
            <option value="small">Small (12px)</option>
            <option value="medium">Medium (14px)</option>
            <option value="large">Large (16px)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="autoHide">
            Auto-hide after inactivity
            <span class="slider-value" id="autoHideValue">Disabled</span>
          </label>
          <div class="slider-container">
            <input type="range" min="0" max="300" value="0" step="30" class="slider" id="autoHide">
          </div>
          <div class="help-text">
            Automatically minimize the widget after seconds of inactivity (0 = disabled)
          </div>
        </div>
        
        <button id="saveAppearanceButton">Save Appearance</button>
      </div>
    </div>
    
    <!-- Shortcuts Tab -->
    <div class="tab-content" id="shortcutsTab">
      <div class="section">
        <h2>Keyboard Shortcuts</h2>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="enableShortcuts" checked>
            Enable keyboard shortcuts
          </label>
        </div>
        
        <div class="form-group">
          <label for="toggleShortcut">Toggle Widget</label>
          <input type="text" id="toggleShortcut" value="Ctrl+Shift+A" readonly>
          <div class="help-text">
            Press this combination to show/hide the assistant widget
          </div>
        </div>
        
        <div class="form-group">
          <label for="minimizeShortcut">Minimize Widget</label>
          <input type="text" id="minimizeShortcut" value="Escape" readonly>
          <div class="help-text">
            Press this key when the widget is focused to minimize it
          </div>
        </div>
        
        <button id="saveShortcutsButton">Save Shortcuts</button>
      </div>
    </div>
    
    <!-- About Tab -->
    <div class="tab-content" id="aboutTab">
      <div class="section">
        <h2>About Universal Web Assistant</h2>
        <p style="color: #666; font-size: 14px; line-height: 1.6;">
          Universal Web Assistant uses Jina AI to extract page content and connects to your chosen AI provider 
          for intelligent responses. The extension supports multiple AI models including Albert (French government AI), 
          OpenAI, Anthropic, and custom endpoints.
        </p>
        
        <h3 style="font-size: 16px; margin-top: 24px;">Supported Providers:</h3>
        <ul style="color: #666; font-size: 14px; line-height: 1.8;">
          <li><strong>Albert:</strong> Free French government AI, great for general assistance</li>
          <li><strong>OpenAI:</strong> GPT models for advanced capabilities</li>
          <li><strong>Anthropic:</strong> Claude models for nuanced responses</li>
          <li><strong>Custom:</strong> Connect to any OpenAI-compatible API</li>
        </ul>
        
        <h3 style="font-size: 16px; margin-top: 24px;">Privacy:</h3>
        <p style="color: #666; font-size: 14px; line-height: 1.6;">
          All settings are stored locally in your browser. API keys are encrypted and only sent to your 
          selected AI provider. No data is collected or stored by the extension itself. Page content is 
          extracted using Jina AI's privacy-respecting service.
        </p>
        
        <h3 style="font-size: 16px; margin-top: 24px;">Version:</h3>
        <p style="color: #666; font-size: 14px;">
          Version 1.1.0 - Multi-model support with enhanced UI
        </p>
      </div>
    </div>
  </div>
  
  <script src="default-config.js"></script>
  <script src="crypto-utils.js"></script>
  <script src="options-new.js"></script>
</body>
</html>